<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggregator Dashboard - Admin View</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Original Aggregator Dashboard styles */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        .status-active {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-inactive {
            background-color: #e5e7eb;
            color: #4b5563;
        }
        .status-suspended {
            background-color: #fef9c3;
            color: #b45309;
        }
        .status-terminated {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .status-clean {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-suspect {
            background-color: #fef9c3;
            color: #b45309;
        }
        .status-fraud {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 4px;
        }
        .badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-primary {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .badge-success {
            background-color: #dcfce7;
            color: #166534;
        }
        .badge-warning {
            background-color: #fef9c3;
            color: #854d0e;
        }
        .badge-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }

        /* Admin/Sectional View Specific Styles */
        .content-section {
            display: none; /* Hide all sections by default */
        }
        .content-section.active {
            display: block; /* Show only the active section */
        }
        .nav-item.active {
            background-color: #1e40af; /* Darker blue for active state */
        }
        .tab-button.active {
            background-color: #1e40af;
            color: white;
        }
        /* Modal styles */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1000; /* Ensure modals are on top */
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.5); 
            justify-content: center;
            align-items: center;
        }
        .modal-content { 
            background-color: #fefefe; 
            margin: auto; /* Centering */
            padding: 20px; 
            border: 1px solid #888; 
            width: 90%; 
            max-width: 700px; 
            border-radius: 8px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative; /* For close button positioning */
        }
        .close-button { 
            color: #aaa; 
            float: right; 
            font-size: 28px; 
            font-weight: bold; 
            cursor: pointer; 
            position: absolute; /* Position relative to modal-content */
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <div class="w-64 bg-blue-800 text-white p-4 flex flex-col shadow-lg">
            <div class="flex items-center justify-between mb-8 mt-4">
                <h1 class="text-2xl font-bold">Aggregator Admin</h1>
            </div>
            
            <!-- Admin Profile -->
            <div class="bg-blue-700 p-4 rounded-xl mb-6 shadow-md">
                <div class="flex items-center mb-3">
                    <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-xl font-bold mr-3">AD</div>
                    <div>
                        <p class="font-medium">Admin User</p>
                        <p class="text-sm text-blue-200">ADMIN-001</p>
                    </div>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <span class="status-badge status-active">Online</span>
                    <span>Full Access</span>
                </div>
            </div>
            
            <nav class="flex-grow">
                <ul>
                    <li class="mb-2">
                        <a href="#dashboard-section" class="nav-item block p-3 rounded-lg hover:bg-blue-700 active" onclick="showSection(this, 'dashboard-section')">
                            <i class="fas fa-tachometer-alt mr-3 text-lg"></i> Dashboard
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#agent-base-section" class="nav-item block p-3 rounded-lg hover:bg-blue-700" onclick="showSection(this, 'agent-base-section')">
                            <i class="fas fa-user-tie mr-3 text-lg"></i> Agent Base
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#asr-section" class="nav-item block p-3 rounded-lg hover:bg-blue-700" onclick="showSection(this, 'asr-section')">
                            <i class="fas fa-users mr-3 text-lg"></i> ASR
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#merchant-base-section" class="nav-item block p-3 rounded-lg hover:bg-blue-700" onclick="showSection(this, 'merchant-base-section')">
                            <i class="fas fa-store mr-3 text-lg"></i> Merchant Base
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#commissions-section" class="nav-item block p-3 rounded-lg hover:bg-blue-700" onclick="showSection(this, 'commissions-section')">
                            <i class="fas fa-money-bill-wave mr-3 text-lg"></i> Commissions
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#requests-section" class="nav-item block p-3 rounded-lg hover:bg-blue-700" onclick="showSection(this, 'requests-section')">
                            <i class="fas fa-envelope mr-3 text-lg"></i> Requests
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#tasks-section" class="nav-item block p-3 rounded-lg hover:bg-blue-700" onclick="showSection(this, 'tasks-section')">
                            <i class="fas fa-tasks mr-3 text-lg"></i> Assigned Tasks
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- Logout Button -->
            <div class="mt-auto pt-6 border-t border-blue-700">
                <button class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 ease-in-out" onclick="logout()">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                <h2 class="text-3xl font-bold text-gray-800">Aggregator Dashboard</h2>
                <div class="flex items-center space-x-4">
                    <div class="bg-white p-2 rounded-lg shadow">
                        <span class="text-gray-500 mr-2">Last Sync:</span>
                        <span class="font-medium">Today, 10:45 AM</span>
                    </div>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        <i class="fas fa-sync-alt mr-2"></i> Refresh
                    </button>
                    <button onclick="showCustomMessage('Admin Action', 'This button would open a panel to manage overall dashboard settings.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                        <i class="fas fa-cogs mr-2"></i> Manage Dashboard
                    </button>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section active">
                <!-- Aggregator Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Total Agents</p>
                        <p class="text-2xl font-bold mt-1">42</p>
                        <div class="flex items-center mt-2">
                            <span class="text-green-500 mr-1"><i class="fas fa-arrow-up"></i> 12%</span>
                            <span class="text-sm text-gray-500">from last month</span>
                        </div>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Total Agents data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Active Agents</p>
                        <p class="text-2xl font-bold mt-1">38</p>
                        <p class="text-sm text-gray-500 mt-2">90% active rate</p>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Active Agents data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Float Balance</p>
                        <p class="text-2xl font-bold mt-1">TZS 12,500</p>
                        <div class="flex items-center mt-2">
                            <span class="text-red-500 mr-1"><i class="fas fa-arrow-down"></i> 8%</span>
                            <span class="text-sm text-gray-500">from last week</span>
                        </div>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Float Balance data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Estimated Commission</p>
                        <p class="text-2xl font-bold mt-1">TZS 5,280</p>
                        <p class="text-sm text-gray-500 mt-2">Based on current performance</p>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Estimated Commission data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                </div>

                <!-- Agent Activity and Float Distribution -->
                <div class="bg-white p-6 rounded-xl shadow mb-8">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Agent Activity</h3>
                            <div class="chart-container">
                                <canvas id="agentActivityChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Float Distribution</h3>
                            <div class="chart-container">
                                <canvas id="floatDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Agent Activity -->
                <div class="bg-white p-6 rounded-xl shadow">
                    <h3 class="text-xl font-semibold mb-4">Recent Agent Activity</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Agent Name</th>
                                    <th class="p-3 text-left">Agent ID</th>
                                    <th class="p-3 text-left">Last Transaction</th>
                                    <th class="p-3 text-left">Transaction Type</th>
                                    <th class="p-3 text-left">Amount</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Sarah Miller</td>
                                    <td class="p-3">AG-2001</td>
                                    <td class="p-3">Today, 10:30 AM</td>
                                    <td class="p-3">Cash Out</td>
                                    <td class="p-3">TZS 200.00</td>
                                    <td class="p-3"><span class="status-badge status-clean">Clean</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Profile" onclick="showAgentProfile('AG-2001')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800" title="Edit Agent" onclick="showCustomMessage('Admin Action', 'Edit Agent AG-2001.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">David Wilson</td>
                                    <td class="p-3">AG-2002</td>
                                    <td class="p-3">Today, 9:15 AM</td>
                                    <td class="p-3">Cash In</td>
                                    <td class="p-3">TZS 150.00</td>
                                    <td class="p-3"><span class="status-badge status-suspect">Suspect</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Profile" onclick="showAgentProfile('AG-2002')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800" title="Edit Agent" onclick="showCustomMessage('Admin Action', 'Edit Agent AG-2002.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Michael Brown</td>
                                    <td class="p-3">AG-2003</td>
                                    <td class="p-3">Yesterday, 4:45 PM</td>
                                    <td class="p-3">Cash Out</td>
                                    <td class="p-3">TZS 500.00</td>
                                    <td class="p-3"><span class="status-badge status-fraud">Fraud</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Profile" onclick="showAgentProfile('AG-2003')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800" title="Edit Agent" onclick="showCustomMessage('Admin Action', 'Edit Agent AG-2003.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Agent Base Section -->
            <section id="agent-base-section" class="content-section">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800">Agent Base Management</h2>
                    <div class="flex items-center space-x-4">
                        <button onclick="openAgentModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-user-plus mr-2"></i> Add Agent
                        </button>
                        <div class="relative">
                            <input type="text" placeholder="Search agents..." class="pl-10 pr-4 py-2 rounded-lg border">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Agent Base settings.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-cogs mr-2"></i> Manage Data
                        </button>
                    </div>
                </header>

                <div class="bg-white p-6 rounded-xl shadow">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-xl font-semibold">Agent Network Overview</h3>
                            <p class="text-sm text-gray-500">Total: 42 agents (38 active, 4 inactive)</p>
                        </div>
                        <select id="agentFilter" class="bg-gray-100 p-2 rounded-lg border">
                            <option value="all">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="suspended">Suspended</option>
                            <option value="terminated">Terminated</option>
                        </select>
                    </div>

                    <div class="overflow-x-auto">
                        <table id="agentTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Agent Name</th>
                                    <th class="p-3 text-left">Agent ID</th>
                                    <th class="p-3 text-left">Tier</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-left">Last Activity</th>
                                    <th class="p-3 text-left">Total Transactions</th>
                                    <th class="p-3 text-left">Total Volume (TZS)</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Sarah Miller</td>
                                    <td class="p-3">AG-2001</td>
                                    <td class="p-3">Tier 2</td>
                                    <td class="p-3"><span class="status-badge status-active">Active</span></td>
                                    <td class="p-3">Today, 10:30 AM</td>
                                    <td class="p-3">142</td>
                                    <td class="p-3">TZS 28,450</td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Profile" onclick="showAgentProfile('AG-2001')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Agent" onclick="openAgentModal('AG-2001', 'Sarah Miller', 'Tier 2', 'active', '2023-03-15')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Agent" onclick="confirmDelete('Agent Sarah Miller')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">David Wilson</td>
                                    <td class="p-3">AG-2002</td>
                                    <td class="p-3">Tier 1</td>
                                    <td class="p-3"><span class="status-badge status-suspended">Suspended</span></td>
                                    <td class="p-3">Today, 9:15 AM</td>
                                    <td class="p-3">98</td>
                                    <td class="p-3">TZS 19,750</td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Profile" onclick="showAgentProfile('AG-2002')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Agent" onclick="openAgentModal('AG-2002', 'David Wilson', 'Tier 1', 'suspended', '2023-05-22')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Agent" onclick="confirmDelete('Agent David Wilson')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Michael Brown</td>
                                    <td class="p-3">AG-2003</td>
                                    <td class="p-3">Tier 2</td>
                                    <td class="p-3"><span class="status-badge status-terminated">Terminated</span></td>
                                    <td class="p-3">2 weeks ago</td>
                                    <td class="p-3">215</td>
                                    <td class="p-3">TZS 42,300</td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Profile" onclick="showAgentProfile('AG-2003')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Agent" onclick="openAgentModal('AG-2003', 'Michael Brown', 'Tier 2', 'terminated', '2023-02-10')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Agent" onclick="confirmDelete('Agent Michael Brown')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Showing 1 to 3 of 42 agents</span>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">Previous</button>
                            <button class="px-3 py-1 bg-blue-600 text-white rounded-lg">1</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">2</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">3</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">Next</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ASR Section -->
            <section id="asr-section" class="content-section">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800">Aggregator Sales Reps (ASR)</h2>
                    <div class="flex items-center space-x-4">
                        <button onclick="openASRModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-user-plus mr-2"></i> Add ASR
                        </button>
                        <div class="relative">
                            <input type="text" placeholder="Search ASRs..." class="pl-10 pr-4 py-2 rounded-lg border">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <button onclick="showCustomMessage('Admin Action', 'Manage ASR settings.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-cogs mr-2"></i> Manage Data
                        </button>
                    </div>
                </header>

                <!-- ASR Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Total ASRs</p>
                        <p class="text-2xl font-bold mt-1">24</p>
                        <div class="flex items-center mt-2">
                            <span class="text-green-500 mr-1"><i class="fas fa-arrow-up"></i> 12%</span>
                            <span class="text-sm text-gray-500">from last month</span>
                        </div>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Total ASRs data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Active ASRs</p>
                        <p class="text-2xl font-bold mt-1">18</p>
                        <p class="text-sm text-gray-500 mt-2">75% active rate</p>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Active ASRs data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Agent Recruitment</p>
                        <p class="text-2xl font-bold mt-1">15/20</p>
                        <div class="flex items-center mt-2">
                            <span class="text-green-500 mr-1">75%</span>
                            <span class="text-sm text-gray-500">of monthly target</span>
                        </div>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Agent Recruitment data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow">
                        <p class="text-gray-500">Float Distribution</p>
                        <p class="text-2xl font-bold mt-1">TZS 64,230</p>
                        <p class="text-sm text-gray-500 mt-2">98 transactions</p>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Float Distribution data.', 'alert')" class="w-full mt-2 bg-purple-600 text-white py-1 rounded-lg hover:bg-purple-700 text-sm">
                            <i class="fas fa-cogs mr-1"></i> Manage
                        </button>
                    </div>
                </div>

                <!-- ASR Float Distribution -->
                <div class="bg-white p-6 rounded-xl shadow mb-6">
                    <h3 class="text-xl font-semibold mb-4">ASR Float Distribution</h3>
                    <div class="overflow-x-auto">
                        <table id="asrFloatTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">ASR Name</th>
                                    <th class="p-3 text-left">ASR ID</th>
                                    <th class="p-3 text-left">Assigned Area</th>
                                    <th class="p-3 text-left">Total Float (TZS)</th>
                                    <th class="p-3 text-left">ASR to Agent (TZS)</th>
                                    <th class="p-3 text-left">Agent to ASR (TZS)</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">John Smith</td>
                                    <td class="p-3">ASR-1001</td>
                                    <td class="p-3">Downtown District</td>
                                    <td class="p-3">TZS 8,450</td>
                                    <td class="p-3">TZS 3,200</td>
                                    <td class="p-3">TZS 5,250</td>
                                    <td class="p-3"><span class="status-badge status-active">Active</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit ASR Float" onclick="showCustomMessage('Admin Action', 'Edit ASR-1001 float data.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove ASR Float" onclick="confirmDelete('ASR-1001 float data')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Sarah Johnson</td>
                                    <td class="p-3">ASR-1002</td>
                                    <td class="p-3">Westside Area</td>
                                    <td class="p-3">TZS 7,800</td>
                                    <td class="p-3">TZS 2,950</td>
                                    <td class="p-3">TZS 4,850</td>
                                    <td class="p-3"><span class="status-badge status-active">Active</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit ASR Float" onclick="showCustomMessage('Admin Action', 'Edit ASR-1002 float data.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove ASR Float" onclick="confirmDelete('ASR-1002 float data')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Michael Brown</td>
                                    <td class="p-3">ASR-1003</td>
                                    <td class="p-3">East Market</td>
                                    <td class="p-3">TZS 6,980</td>
                                    <td class="p-3">TZS 2,750</td>
                                    <td class="p-3">TZS 4,230</td>
                                    <td class="p-3"><span class="status-badge status-suspended">Suspended</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit ASR Float" onclick="showCustomMessage('Admin Action', 'Edit ASR-1003 float data.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove ASR Float" onclick="confirmDelete('ASR-1003 float data')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ASR Recruitment Performance -->
                <div class="bg-white p-6 rounded-xl shadow mb-6">
                    <h3 class="text-xl font-semibold mb-4">ASR Recruitment Performance</h3>
                    <div class="overflow-x-auto">
                        <table id="asrRecruitmentTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">ASR Name</th>
                                    <th class="p-3 text-left">Assigned Area</th>
                                    <th class="p-3 text-left">Target Agents</th>
                                    <th class="p-3 text-left">Recruited</th>
                                    <th class="p-3 text-left">Active Rate</th>
                                    <th class="p-3 text-left">Performance</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">John Smith</td>
                                    <td class="p-3">Downtown District</td>
                                    <td class="p-3">8</td>
                                    <td class="p-3">6</td>
                                    <td class="p-3">83%</td>
                                    <td class="p-3">
                                        <span class="badge badge-success">Excellent</span>
                                    </td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Recruitment Data" onclick="showCustomMessage('Admin Action', 'Edit John Smith recruitment data.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Recruitment Data" onclick="confirmDelete('John Smith recruitment data')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Sarah Johnson</td>
                                    <td class="p-3">Westside Area</td>
                                    <td class="p-3">6</td>
                                    <td class="p-3">5</td>
                                    <td class="p-3">80%</td>
                                    <td class="p-3">
                                        <span class="badge badge-success">Good</span>
                                    </td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Recruitment Data" onclick="showCustomMessage('Admin Action', 'Edit Sarah Johnson recruitment data.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Recruitment Data" onclick="confirmDelete('Sarah Johnson recruitment data')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Michael Brown</td>
                                    <td class="p-3">East Market</td>
                                    <td class="p-3">6</td>
                                    <td class="p-3">4</td>
                                    <td class="p-3">75%</td>
                                    <td class="p-3">
                                        <span class="badge badge-warning">Average</span>
                                    </td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Recruitment Data" onclick="showCustomMessage('Admin Action', 'Edit Michael Brown recruitment data.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Recruitment Data" onclick="confirmDelete('Michael Brown recruitment data')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Agents Under ASR -->
                <div class="bg-white p-6 rounded-xl shadow mb-6">
                    <h3 class="text-xl font-semibold mb-4">Agents Under ASR</h3>
                    <div class="mb-4 flex items-center space-x-2">
                        <select id="asrAgentFilter" class="bg-gray-100 p-2 rounded-lg border">
                            <option value="all">All ASRs</option>
                            <option value="ASR-1001">John Smith (ASR-1001)</option>
                            <option value="ASR-1002">Sarah Johnson (ASR-1002)</option>
                            <option value="ASR-1003">Michael Brown (ASR-1003)</option>
                        </select>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Agents Under ASR data.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-cogs mr-1"></i> Manage Data
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table id="agentsUnderAsrTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Agent Name</th>
                                    <th class="p-3 text-left">Agent ID</th>
                                    <th class="p-3 text-left">Assigned ASR</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-left">Recruited On</th>
                                    <th class="p-3 text-left">Last Activity</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">David Wilson</td>
                                    <td class="p-3">AG-2001</td>
                                    <td class="p-3">John Smith (ASR-1001)</td>
                                    <td class="p-3"><span class="status-badge status-active">Active</span></td>
                                    <td class="p-3">2023-05-15</td>
                                    <td class="p-3">Today, 10:30 AM</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Agent" onclick="showCustomMessage('Admin Action', 'Edit Agent AG-2001.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Agent" onclick="confirmDelete('Agent AG-2001')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Emily Davis</td>
                                    <td class="p-3">AG-2002</td>
                                    <td class="p-3">John Smith (ASR-1001)</td>
                                    <td class="p-3"><span class="status-badge status-active">Active</span></td>
                                    <td class="p-3">2023-06-22</td>
                                    <td class="p-3">Today, 9:15 AM</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Agent" onclick="showCustomMessage('Admin Action', 'Edit Agent AG-2002.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Agent" onclick="confirmDelete('Agent AG-2002')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Robert Johnson</td>
                                    <td class="p-3">AG-2003</td>
                                    <td class="p-3">Sarah Johnson (ASR-1002)</td>
                                    <td class="p-3"><span class="status-badge status-inactive">Inactive</span></td>
                                    <td class="p-3">2023-04-10</td>
                                    <td class="p-3">2 weeks ago</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Agent" onclick="showCustomMessage('Admin Action', 'Edit Agent AG-2003.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Agent" onclick="confirmDelete('Agent AG-2003')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Top Performing ASRs -->
                <div class="bg-white p-6 rounded-xl shadow">
                    <h3 class="text-xl font-semibold mb-4">Top Performing ASRs</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3">1</div>
                                <div>
                                    <p class="font-medium">John Smith</p>
                                    <p class="text-sm text-gray-500">ASR-1001</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <p class="text-gray-500 text-sm">Agents</p>
                                    <p class="font-bold">6/8</p>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Float</p>
                                    <p class="font-bold">TZS 8,450</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3">2</div>
                                <div>
                                    <p class="font-medium">Sarah Johnson</p>
                                    <p class="text-sm text-gray-500">ASR-1002</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <p class="text-gray-500 text-sm">Agents</p>
                                    <p class="font-bold">5/6</p>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Float</p>
                                    <p class="font-bold">TZS 7,800</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3">3</div>
                                <div>
                                    <p class="font-medium">Michael Brown</p>
                                    <p class="text-sm text-gray-500">ASR-1003</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <p class="text-gray-500 text-sm">Agents</p>
                                    <p class="font-bold">4/6</p>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Float</p>
                                    <p class="font-bold">TZS 6,980</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Merchant Base Section -->
            <section id="merchant-base-section" class="content-section">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800">Merchant Base</h2>
                    <div class="flex items-center space-x-4">
                        <button onclick="openMerchantModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-store-alt mr-2"></i> Add Merchant
                        </button>
                        <div class="relative">
                            <input type="text" placeholder="Search merchants..." class="pl-10 pr-4 py-2 rounded-lg border">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Merchant Base settings.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-cogs mr-2"></i> Manage Data
                        </button>
                    </div>
                </header>

                <div class="bg-white p-6 rounded-xl shadow">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-xl font-semibold">Merchant Network</h3>
                            <p class="text-sm text-gray-500">Total: 56 merchants (42 active, 14 inactive)</p>
                        </div>
                        <select id="merchantFilter" class="bg-gray-100 p-2 rounded-lg border">
                            <option value="all">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table id="merchantTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Merchant Name</th>
                                    <th class="p-3 text-left">Merchant ID</th>
                                    <th class="p-3 text-left">Category</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-left">Agents</th>
                                    <th class="p-3 text-left">Last Settlement (TZS)</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">QuickPay Store</td>
                                    <td class="p-3">MCH-5001</td>
                                    <td class="p-3">Retail</td>
                                    <td class="p-3"><span class="status-badge status-active">Active</span></td>
                                    <td class="p-3">12</td>
                                    <td class="p-3">Today, TZS 1,250</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Merchant" onclick="openMerchantModal('MCH-5001', 'QuickPay Store', 'Retail', 'active', '12')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Merchant" onclick="confirmDelete('Merchant QuickPay Store')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">City Market</td>
                                    <td class="p-3">MCH-5002</td>
                                    <td class="p-3">Supermarket</td>
                                    <td class="p-3"><span class="status-badge status-active">Active</span></td>
                                    <td class="p-3">8</td>
                                    <td class="p-3">Today, TZS 980</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Merchant" onclick="openMerchantModal('MCH-5002', 'City Market', 'Supermarket', 'active', '8')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Merchant" onclick="confirmDelete('Merchant City Market')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Mobile Zone</td>
                                    <td class="p-3">MCH-5003</td>
                                    <td class="p-3">Telecom</td>
                                    <td class="p-3"><span class="status-badge status-inactive">Inactive</span></td>
                                    <td class="p-3">5</td>
                                    <td class="p-3">2 weeks ago</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Merchant" onclick="openMerchantModal('MCH-5003', 'Mobile Zone', 'Telecom', 'inactive', '5')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Merchant" onclick="confirmDelete('Merchant Mobile Zone')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Showing 1 to 3 of 56 merchants</span>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">Previous</button>
                            <button class="px-3 py-1 bg-blue-600 text-white rounded-lg">1</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">2</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">3</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">Next</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Commissions Section -->
            <section id="commissions-section" class="content-section">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800">Commissions</h2>
                    <div class="flex items-center space-x-4">
                        <select class="bg-gray-100 p-2 rounded-lg border" id="month-select">
                            <option value="0">This Month</option>
                            <option value="-1">Last Month</option>
                            <option value="-2">2 Months Ago</option>
                            <option value="-3">3 Months Ago</option>
                            <option value="-4">4 Months Ago</option>
                            <option value="-5">5 Months Ago</option>
                            <option value="-6">6 Months Ago</option>
                        </select>
                        <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-download mr-2"></i> Export
                        </button>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Commission settings and rules.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-cogs mr-2"></i> Manage Data
                        </button>
                    </div>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-xl shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Current Month</h3>
                            <span class="text-sm bg-green-100 text-green-800 px-2 py-1 rounded-full">Estimated</span>
                        </div>
                        <p class="text-3xl font-bold">TZS 5,280</p>
                        <div class="flex items-center mt-2">
                            <span class="text-green-500 mr-1"><i class="fas fa-arrow-up"></i> 15%</span>
                            <span class="text-sm text-gray-500">from last month</span>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-gray-500">Target</span>
                                <span>TZS 6,000</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-blue-600" style="width: 88%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-lg font-semibold mb-4">Last Month</h3>
                        <p class="text-3xl font-bold">TZS 4,592</p>
                        <p class="text-sm text-gray-500 mt-2">Paid on 5th July</p>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Base Commissions</span>
                                <span>TZS 3,842</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Performance Bonus</span>
                                <span>TZS 750</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-lg font-semibold mb-4">Fraud Adjustments</h3>
                        <p class="text-3xl font-bold text-red-600">TZS -320</p>
                        <p class="text-sm text-gray-500 mt-2">Deducted from commissions</p>
                        <div class="mt-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Confirmed Fraud</span>
                                <span class="text-red-600">TZS -280</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Suspected Fraud</span>
                                <span class="text-red-600">TZS -40</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow">
                    <h3 class="text-xl font-semibold mb-4">Commission Breakdown</h3>
                    <div class="chart-container mb-6">
                        <canvas id="commissionChart"></canvas>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table id="commissionTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Agent</th>
                                    <th class="p-3 text-left">Transaction Type</th>
                                    <th class="p-3 text-left">Amount (TZS)</th>
                                    <th class="p-3 text-left">Commission (TZS)</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-left">Adjustment (TZS)</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Sarah Miller (AG-2001)</td>
                                    <td class="p-3">Cash Out</td>
                                    <td class="p-3">TZS 200.00</td>
                                    <td class="p-3">TZS 6.00</td>
                                    <td class="p-3"><span class="status-badge status-clean">Clean</span></td>
                                    <td class="p-3">TZS 0.00</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Commission" onclick="showCustomMessage('Admin Action', 'Edit commission for Sarah Miller.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Commission" onclick="confirmDelete('Commission for Sarah Miller')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">David Wilson (AG-2002)</td>
                                    <td class="p-3">Cash In</td>
                                    <td class="p-3">TZS 150.00</td>
                                    <td class="p-3">TZS 4.50</td>
                                    <td class="p-3"><span class="status-badge status-suspect">Suspect</span></td>
                                    <td class="p-3 text-red-600">TZS -1.50</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Commission" onclick="showCustomMessage('Admin Action', 'Edit commission for David Wilson.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Commission" onclick="confirmDelete('Commission for David Wilson')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Michael Brown (AG-2003)</td>
                                    <td class="p-3">Cash Out</td>
                                    <td class="p-3">TZS 500.00</td>
                                    <td class="p-3">TZS 15.00</td>
                                    <td class="p-3"><span class="status-badge status-fraud">Fraud</span></td>
                                    <td class="p-3 text-red-600">TZS -15.00</td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Commission" onclick="showCustomMessage('Admin Action', 'Edit commission for Michael Brown.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Commission" onclick="confirmDelete('Commission for Michael Brown')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Requests Section -->
            <section id="requests-section" class="content-section">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800">Requests</h2>
                    <div class="flex items-center space-x-4">
                        <select id="requestFilter" class="bg-gray-100 p-2 rounded-lg border">
                            <option value="all">All Requests</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Request settings.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-cogs mr-2"></i> Manage Data
                        </button>
                    </div>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Delete Agent Request -->
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-xl font-semibold mb-4">Request Agent Deletion</h3>
                        <form onsubmit="submitAgentDeletionRequest(event)" class="space-y-4">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Select Agent</label>
                                <select id="delete-agent-select" class="w-full p-2 border rounded-lg">
                                    <option value="">Select Agent</option>
                                    <option value="AG-2001">Sarah Miller (AG-2001)</option>
                                    <option value="AG-2002">David Wilson (AG-2002)</option>
                                    <option value="AG-2003">Michael Brown (AG-2003)</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Reason for Deletion</label>
                                <select id="delete-reason-select" class="w-full p-2 border rounded-lg">
                                    <option value="">Select Reason</option>
                                    <option>Inactivity</option>
                                    <option>Policy Violation</option>
                                    <option>Fraudulent Activity</option>
                                    <option>Agent Request</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Additional Notes</label>
                                <textarea id="delete-notes" class="w-full p-2 border rounded-lg" rows="3"></textarea>
                            </div>
                            <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-trash-alt mr-2"></i> Submit Deletion Request
                            </button>
                        </form>
                    </div>
                    
                    <!-- Map Agent Request -->
                    <div class="bg-white p-6 rounded-xl shadow">
                        <h3 class="text-xl font-semibold mb-4">Request Agent Mapping</h3>
                        <form onsubmit="submitAgentMappingRequest(event)" class="space-y-4">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Select Agent</label>
                                <select id="map-agent-select" class="w-full p-2 border rounded-lg">
                                    <option value="">Select Agent</option>
                                    <option value="AG-2015">John Smith (AG-2015)</option>
                                    <option value="AG-2016">Emily Davis (AG-2016)</option>
                                    <option value="AG-2017">Robert Wilson (AG-2017)</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Current Aggregator</label>
                                <input type="text" class="w-full p-2 border rounded-lg" value="East Region Aggregator" readonly>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Reason for Mapping</label>
                                <select id="map-reason-select" class="w-full p-2 border rounded-lg">
                                    <option value="">Select Reason</option>
                                    <option>Geographical Realignment</option>
                                    <option>Performance Optimization</option>
                                    <option>Agent Request</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Additional Notes</label>
                                <textarea id="map-notes" class="w-full p-2 border rounded-lg" rows="3"></textarea>
                            </div>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-map-marker-alt mr-2"></i> Submit Mapping Request
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Pending Requests -->
                <div class="bg-white p-6 rounded-xl shadow">
                    <h3 class="text-xl font-semibold mb-4">Pending Requests</h3>
                    <div class="overflow-x-auto">
                        <table id="pendingRequestsTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Request ID</th>
                                    <th class="p-3 text-left">Type</th>
                                    <th class="p-3 text-left">Agent</th>
                                    <th class="p-3 text-left">Reason</th>
                                    <th class="p-3 text-left">Submitted</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">REQ-1001</td>
                                    <td class="p-3">Deletion</td>
                                    <td class="p-3">Michael Brown (AG-2003)</td>
                                    <td class="p-3">Inactivity</td>
                                    <td class="p-3">2023-07-10</td>
                                    <td class="p-3"><span class="status-badge status-active">Pending</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Details" onclick="showCustomMessage('Admin Action', 'View details for REQ-1001.', 'alert')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Approve Request" onclick="showCustomMessage('Admin Action', 'Approve REQ-1001.', 'alert')">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Reject Request" onclick="showCustomMessage('Admin Action', 'Reject REQ-1001.', 'alert')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">REQ-1002</td>
                                    <td class="p-3">Mapping</td>
                                    <td class="p-3">John Smith (AG-2015)</td>
                                    <td class="p-3">Geographical Realignment</td>
                                    <td class="p-3">2023-07-08</td>
                                    <td class="p-3"><span class="status-badge status-active">Pending</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-blue-600 hover:text-blue-800 mr-2" title="View Details" onclick="showCustomMessage('Admin Action', 'View details for REQ-1002.', 'alert')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Approve Request" onclick="showCustomMessage('Admin Action', 'Approve REQ-1002.', 'alert')">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Reject Request" onclick="showCustomMessage('Admin Action', 'Reject REQ-1002.', 'alert')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Assigned Tasks Section -->
            <section id="tasks-section" class="content-section">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800">Assigned Tasks</h2>
                    <div class="flex items-center space-x-4">
                        <button onclick="openTaskModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i> New Task
                        </button>
                        <select id="taskFilter" class="bg-gray-100 p-2 rounded-lg border">
                            <option value="all">All Tasks</option>
                            <option value="pending">Pending</option>
                            <option value="in progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                        <button onclick="showCustomMessage('Admin Action', 'Manage Task settings.', 'alert')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            <i class="fas fa-cogs mr-2"></i> Manage Data
                        </button>
                    </div>
                </header>

                <div class="bg-white p-6 rounded-xl shadow">
                    <div class="overflow-x-auto">
                        <table id="tasksTable" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left">Task</th>
                                    <th class="p-3 text-left">Assigned To</th>
                                    <th class="p-3 text-left">Priority</th>
                                    <th class="p-3 text-left">Due Date</th>
                                    <th class="p-3 text-left">Status</th>
                                    <th class="p-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Review ASR performance in Downtown</td>
                                    <td class="p-3">John Smith (ASR-1001)</td>
                                    <td class="p-3"><span class="badge badge-primary">High</span></td>
                                    <td class="p-3">Today</td>
                                    <td class="p-3"><span class="status-badge status-active">In Progress</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Task" onclick="showCustomMessage('Admin Action', 'Edit task: Review ASR performance in Downtown.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Task" onclick="confirmDelete('Task: Review ASR performance in Downtown')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Recruit 2 new agents in Westside</td>
                                    <td class="p-3">Sarah Johnson (ASR-1002)</td>
                                    <td class="p-3"><span class="badge badge-warning">Medium</span></td>
                                    <td class="p-3">Tomorrow</td>
                                    <td class="p-3"><span class="status-badge status-inactive">Pending</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Task" onclick="showCustomMessage('Admin Action', 'Edit task: Recruit 2 new agents in Westside.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Task" onclick="confirmDelete('Task: Recruit 2 new agents in Westside')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="p-3">Investigate fraud cases in East Market</td>
                                    <td class="p-3">Michael Brown (ASR-1003)</td>
                                    <td class="p-3"><span class="badge badge-danger">Critical</span></td>
                                    <td class="p-3">Today</td>
                                    <td class="p-3"><span class="status-badge status-active">In Progress</span></td>
                                    <td class="p-3 text-center">
                                        <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Task" onclick="showCustomMessage('Admin Action', 'Edit task: Investigate fraud cases in East Market.', 'alert')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800" title="Remove Task" onclick="confirmDelete('Task: Investigate fraud cases in East Market')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Showing 1 to 3 of 12 tasks</span>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">Previous</button>
                            <button class="px-3 py-1 bg-blue-600 text-white rounded-lg">1</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">2</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">3</button>
                            <button class="px-3 py-1 border rounded-lg hover:bg-gray-100">Next</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Agent Profile Modal -->
    <div id="agent-profile-modal" class="modal">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Agent Profile</h3>
                    <button onclick="closeAgentProfile()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="flex items-center mb-6">
                    <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-2xl font-bold text-white mr-4" id="agent-avatar">SM</div>
                    <div>
                        <h4 class="text-lg font-bold" id="agent-name">Sarah Miller</h4>
                        <p class="text-gray-500" id="agent-id">AG-2001</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <p class="text-gray-500">Tier</p>
                        <p class="font-medium" id="agent-tier">Tier 2</p>
                    </div>
                    <div>
                        <p class="text-gray-500">Status</p>
                        <select class="w-full p-2 border rounded-lg" id="agent-status-select">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="suspended">Suspended</option>
                            <option value="terminated">Terminated</option>
                        </select>
                    </div>
                    <div>
                        <p class="text-gray-500">Registration Date</p>
                        <p class="font-medium" id="agent-reg-date">2023-03-15</p>
                    </div>
                    <div>
                        <p class="text-gray-500">Last Activity</p>
                        <p class="font-medium" id="agent-last-activity">Today, 10:30 AM</p>
                    </div>
                    <div>
                        <p class="text-gray-500">Total Transactions</p>
                        <p class="font-medium" id="agent-txns">142</p>
                    </div>
                    <div>
                        <p class="text-gray-500">Total Volume</p>
                        <p class="font-medium" id="agent-volume">TZS 28,450</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <p class="text-gray-500 mb-2">Performance Rating</p>
                    <div class="flex items-center">
                        <div class="flex mr-2">
                            <i class="fas fa-star text-yellow-400"></i>
                            <i class="fas fa-star text-yellow-400"></i>
                            <i class="fas fa-star text-yellow-400"></i>
                            <i class="fas fa-star text-yellow-400"></i>
                            <i class="fas fa-star-half-alt text-yellow-400"></i>
                        </div>
                        <span class="text-sm text-gray-500">4.5/5</span>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button onclick="closeAgentProfile()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
                        Cancel
                    </button>
                    <button onclick="saveAgentStatus()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Registration Modal -->
    <div id="agentModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeAgentModal()">&times;</span>
            <h3 id="agent-modal-title" class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-user-plus mr-2 text-blue-600"></i> Add New Agent
            </h3>
            <form class="space-y-4" onsubmit="saveAgent(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">Agent Name</label>
                        <input type="text" id="agent-name-input" class="w-full p-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">Agent ID</label>
                        <input type="text" id="agent-id-input" class="w-full p-2 border rounded-lg" required>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Tier</label>
                    <select id="agent-tier-select" class="w-full p-2 border rounded-lg">
                        <option>Tier 1</option>
                        <option>Tier 2</option>
                        <option>Tier 3</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Status</label>
                    <select id="agent-status-input" class="w-full p-2 border rounded-lg">
                        <option>Active</option>
                        <option>Inactive</option>
                        <option>Suspended</option>
                        <option>Terminated</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Registration Date</label>
                    <input type="date" id="agent-reg-date-input" class="w-full p-2 border rounded-lg" required>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeAgentModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Save Agent
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ASR Registration Modal -->
    <div id="asrModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeASRModal()">&times;</span>
            <h3 id="asr-modal-title" class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-user-plus mr-2 text-blue-600"></i> Add New ASR
            </h3>
            <form class="space-y-4" onsubmit="saveASR(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">ASR Name</label>
                        <input type="text" id="asr-name-input" class="w-full p-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">ASR ID</label>
                        <input type="text" id="asr-id-input" class="w-full p-2 border rounded-lg" required>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Assigned Area</label>
                    <input type="text" id="asr-area-input" class="w-full p-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Status</label>
                    <select id="asr-status-input" class="w-full p-2 border rounded-lg">
                        <option>Active</option>
                        <option>Inactive</option>
                        <option>Suspended</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeASRModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Save ASR
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Merchant Registration Modal -->
    <div id="merchantModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeMerchantModal()">&times;</span>
            <h3 id="merchant-modal-title" class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-store mr-2 text-blue-600"></i> Add New Merchant
            </h3>
            <form class="space-y-4" onsubmit="saveMerchant(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">Merchant Name</label>
                        <input type="text" id="merchant-name-input" class="w-full p-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">Merchant ID</label>
                        <input type="text" id="merchant-id-input" class="w-full p-2 border rounded-lg" required>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Category</label>
                    <input type="text" id="merchant-category-input" class="w-full p-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Status</label>
                    <select id="merchant-status-input" class="w-full p-2 border rounded-lg">
                        <option>Active</option>
                        <option>Inactive</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Agents Assigned</label>
                    <input type="number" id="merchant-agents-input" class="w-full p-2 border rounded-lg" required>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeMerchantModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Save Merchant
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeTaskModal()">&times;</span>
            <h3 id="task-modal-title" class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-tasks mr-2 text-blue-600"></i> Create New Task
            </h3>
            <form class="space-y-4" onsubmit="saveTask(event)">
                <div>
                    <label class="block text-gray-700 mb-1">Task Description</label>
                    <input type="text" id="task-description-input" class="w-full p-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Assigned To (ASR ID)</label>
                    <input type="text" id="task-assigned-to-input" class="w-full p-2 border rounded-lg" placeholder="e.g., ASR-1001" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Priority</label>
                    <select id="task-priority-input" class="w-full p-2 border rounded-lg">
                        <option>High</option>
                        <option>Medium</option>
                        <option>Low</option>
                        <option>Critical</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Due Date</label>
                    <input type="date" id="task-due-date-input" class="w-full p-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Status</label>
                    <select id="task-status-input" class="w-full p-2 border rounded-lg">
                        <option>Pending</option>
                        <option>In Progress</option>
                        <option>Completed</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeTaskModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Save Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Confirmation/Alert Message Box -->
    <div id="custom-message-box" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeCustomMessageBox()">&times;</span>
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="message-box-title"></h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500" id="message-box-text"></p>
            </div>
            <div class="items-center px-4 py-3 flex justify-center space-x-4">
                <button id="message-box-cancel" class="px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300">
                    Cancel
                </button>
                <button id="message-box-confirm" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global Chart and DataTable instances to prevent re-initialization issues
        var agentActivityChartInstance = null;
        var floatDistributionChartInstance = null;
        var commissionChartInstance = null;
        var agentTableInstance = null;
        var asrTableInstance = null;
        var asrFloatTableInstance = null;
        var asrRecruitmentTableInstance = null;
        var agentsUnderAsrTableInstance = null;
        var merchantTableInstance = null;
        var pendingRequestsTableInstance = null;
        var tasksTableInstance = null;

        // Sample data for modals (in a real app, this would come from a backend)
        const agentsData = {
            'AG-2001': { name: 'Sarah Miller', tier: 'Tier 2', status: 'active', regDate: '2023-03-15', lastActivity: 'Today, 10:30 AM', transactions: 142, volume: '28,450' },
            'AG-2002': { name: 'David Wilson', tier: 'Tier 1', status: 'suspended', regDate: '2023-05-22', lastActivity: 'Today, 9:15 AM', transactions: 98, volume: '19,750' },
            'AG-2003': { name: 'Michael Brown', tier: 'Tier 2', status: 'terminated', regDate: '2023-02-10', lastActivity: '2 weeks ago', transactions: 215, volume: '42,300' }
        };

        const asrsData = {
            'ASR-1001': { name: 'John Smith', area: 'Downtown District', status: 'active' },
            'ASR-1002': { name: 'Sarah Johnson', area: 'Westside Area', status: 'active' },
            'ASR-1003': { name: 'Michael Brown', area: 'East Market', status: 'suspended' }
        };

        const merchantsData = {
            'MCH-5001': { name: 'QuickPay Store', category: 'Retail', status: 'active', agents: 12 },
            'MCH-5002': { name: 'City Market', category: 'Supermarket', status: 'active', agents: 8 },
            'MCH-5003': { name: 'Mobile Zone', category: 'Telecom', status: 'inactive', agents: 5 }
        };

        const tasksData = [
            { description: 'Review ASR performance in Downtown', assignedTo: 'John Smith (ASR-1001)', priority: 'High', dueDate: 'Today', status: 'In Progress' },
            { description: 'Recruit 2 new agents in Westside', assignedTo: 'Sarah Johnson (ASR-1002)', priority: 'Medium', dueDate: 'Tomorrow', status: 'Pending' },
            { description: 'Investigate fraud cases in East Market', assignedTo: 'Michael Brown (ASR-1003)', priority: 'Critical', dueDate: 'Today', status: 'In Progress' }
        ];

        const requestsData = [
            { id: 'REQ-1001', type: 'Deletion', agent: 'Michael Brown (AG-2003)', reason: 'Inactivity', submitted: '2023-07-10', status: 'Pending' },
            { id: 'REQ-1002', type: 'Mapping', agent: 'John Smith (AG-2015)', reason: 'Geographical Realignment', submitted: '2023-07-08', status: 'Pending' }
        ];


        // Function to show custom modal messages (replaces alert/confirm)
        var confirmCallback = null; // To store the callback for confirmation

        function showCustomMessage(title, message, type = 'alert', onConfirm = null) {
            const messageBox = document.getElementById('custom-message-box');
            document.getElementById('message-box-title').textContent = title;
            document.getElementById('message-box-text').textContent = message;
            
            const confirmButton = document.getElementById('message-box-confirm');
            const cancelButton = document.getElementById('message-box-cancel');

            if (type === 'confirm') {
                confirmButton.style.display = 'inline-block';
                cancelButton.style.display = 'inline-block';
                confirmButton.textContent = 'Confirm';
                confirmButton.onclick = () => {
                    if (confirmCallback) confirmCallback(true);
                    messageBox.style.display = 'none';
                };
                cancelButton.onclick = () => {
                    if (confirmCallback) confirmCallback(false);
                    messageBox.style.display = 'none';
                };
                confirmCallback = onConfirm;
            } else { // 'alert' type
                confirmButton.style.display = 'inline-block';
                cancelButton.style.display = 'none';
                confirmButton.textContent = 'OK';
                confirmButton.onclick = () => {
                    messageBox.style.display = 'none';
                };
                confirmCallback = null;
            }
            messageBox.style.display = 'flex'; // Use flex to center
        }

        function closeCustomMessageBox() {
            document.getElementById('custom-message-box').style.display = 'none';
        }

        function confirmDelete(itemName) {
            showCustomMessage(
                'Confirm Deletion',
                `Are you sure you want to delete ${itemName}? This action cannot be undone.`,
                'confirm',
                (result) => {
                    if (result) {
                        console.log(`Deleting ${itemName}... (simulated)`);
                        showCustomMessage('Deleted!', `${itemName} has been deleted.`, 'alert');
                        // In a real app, you'd send a DELETE request to your backend here
                        // For demonstration, you might want to remove the row from the table dynamically
                        // Example: refresh the table after deletion
                        // if ($.fn.DataTable.isDataTable('#agentTable')) { $('#agentTable').DataTable().ajax.reload(); }
                    } else {
                        console.log(`Deletion of ${itemName} cancelled.`);
                        showCustomMessage('Cancelled', `Deletion of ${itemName} was cancelled.`, 'alert');
                    }
                }
            );
        }

        // Handles navigation by showing the selected section and updating active nav item.
        function showSection(element, sectionId) {
            // Remove 'active' class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            // Add 'active' class to the clicked nav item
            element.classList.add('active');

            // Hide all content sections
            document.querySelectorAll('section.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show the selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Initialize charts/tables specific to the section when it becomes active
            if (sectionId === 'dashboard-section') {
                initAgentActivityChart();
                initFloatDistributionChart();
            } else if (sectionId === 'agent-base-section') {
                initAgentTable();
            } else if (sectionId === 'asr-section') {
                initASRTablesAndCharts();
            } else if (sectionId === 'merchant-base-section') {
                initMerchantTable();
            } else if (sectionId === 'commissions-section') {
                initCommissionChart();
                initCommissionTable();
            } else if (sectionId === 'requests-section') {
                initPendingRequestsTable();
            } else if (sectionId === 'tasks-section') {
                initTasksTable();
            }
        }

        // Agent Profile Modal Functions
        function showAgentProfile(agentId) {
            const agent = agentsData[agentId];
            if (!agent) {
                showCustomMessage('Error', 'Agent not found.', 'alert');
                return;
            }
            document.getElementById('agent-avatar').textContent = agent.name.split(' ').map(n => n[0]).join('');
            document.getElementById('agent-name').textContent = agent.name;
            document.getElementById('agent-id').textContent = agentId;
            document.getElementById('agent-tier').textContent = agent.tier;
            document.getElementById('agent-status-select').value = agent.status;
            document.getElementById('agent-reg-date').textContent = agent.regDate;
            document.getElementById('agent-last-activity').textContent = agent.lastActivity;
            document.getElementById('agent-txns').textContent = agent.transactions;
            document.getElementById('agent-volume').textContent = `TZS ${agent.volume}`;
            
            document.getElementById('agent-profile-modal').style.display = 'flex';
        }

        function closeAgentProfile() {
            document.getElementById('agent-profile-modal').style.display = 'none';
        }

        function saveAgentStatus() {
            const agentId = document.getElementById('agent-id').textContent;
            const newStatus = document.getElementById('agent-status-select').value;
            
            agentsData[agentId].status = newStatus; // Update in sample data
            
            console.log(`Updated ${agentId} status to ${newStatus}`);
            showCustomMessage('Agent Status Updated!', `Agent ${agentsData[agentId].name}'s status updated to ${newStatus}.`, 'alert');
            closeAgentProfile();
            initAgentTable(); // Refresh the table to reflect changes
        }

        // Agent Add/Edit Modal Functions
        function openAgentModal(id = '', name = '', tier = '', status = '', regDate = '') {
            const modal = document.getElementById('agentModal');
            document.getElementById('agent-id-input').value = id;
            document.getElementById('agent-name-input').value = name;
            document.getElementById('agent-tier-select').value = tier;
            document.getElementById('agent-status-input').value = status;
            document.getElementById('agent-reg-date-input').value = regDate;

            if (id) {
                document.getElementById('agent-modal-title').textContent = 'Edit Agent';
                document.getElementById('agent-id-input').readOnly = true; // Prevent editing ID
            } else {
                document.getElementById('agent-modal-title').textContent = 'Add New Agent';
                document.getElementById('agent-id-input').readOnly = false;
            }
            modal.style.display = 'flex';
        }

        function closeAgentModal() {
            document.getElementById('agentModal').style.display = 'none';
        }

        function saveAgent(event) {
            event.preventDefault();
            const id = document.getElementById('agent-id-input').value;
            const name = document.getElementById('agent-name-input').value;
            const tier = document.getElementById('agent-tier-select').value;
            const status = document.getElementById('agent-status-input').value;
            const regDate = document.getElementById('agent-reg-date-input').value;

            // Simulate save operation
            if (agentsData[id]) {
                // Update existing
                agentsData[id] = { ...agentsData[id], name, tier, status, regDate };
                showCustomMessage('Agent Updated!', `Agent ${name} (ID: ${id}) updated.`, 'alert');
            } else {
                // Add new (simplified, real app would generate IDs or handle conflicts)
                agentsData[id] = { name, tier, status, regDate, lastActivity: 'N/A', transactions: 0, volume: '0' };
                showCustomMessage('Agent Added!', `Agent ${name} (ID: ${id}) added.`, 'alert');
            }
            closeAgentModal();
            initAgentTable(); // Refresh table
        }

        // ASR Add/Edit Modal Functions
        function openASRModal(id = '', name = '', area = '', status = '') {
            const modal = document.getElementById('asrModal');
            document.getElementById('asr-id-input').value = id;
            document.getElementById('asr-name-input').value = name;
            document.getElementById('asr-area-input').value = area;
            document.getElementById('asr-status-input').value = status;

            if (id) {
                document.getElementById('asr-modal-title').textContent = 'Edit ASR';
                document.getElementById('asr-id-input').readOnly = true;
            } else {
                document.getElementById('asr-modal-title').textContent = 'Add New ASR';
                document.getElementById('asr-id-input').readOnly = false;
            }
            modal.style.display = 'flex';
        }

        function closeASRModal() {
            document.getElementById('asrModal').style.display = 'none';
        }

        function saveASR(event) {
            event.preventDefault();
            const id = document.getElementById('asr-id-input').value;
            const name = document.getElementById('asr-name-input').value;
            const area = document.getElementById('asr-area-input').value;
            const status = document.getElementById('asr-status-input').value;

            if (asrsData[id]) {
                asrsData[id] = { ...asrsData[id], name, area, status };
                showCustomMessage('ASR Updated!', `ASR ${name} (ID: ${id}) updated.`, 'alert');
            } else {
                asrsData[id] = { name, area, status }; // Simplified
                showCustomMessage('ASR Added!', `ASR ${name} (ID: ${id}) added.`, 'alert');
            }
            closeASRModal();
            initASRTablesAndCharts(); // Refresh all ASR related tables
        }

        // Merchant Add/Edit Modal Functions
        function openMerchantModal(id = '', name = '', category = '', status = '', agents = '') {
            const modal = document.getElementById('merchantModal');
            document.getElementById('merchant-id-input').value = id;
            document.getElementById('merchant-name-input').value = name;
            document.getElementById('merchant-category-input').value = category;
            document.getElementById('merchant-status-input').value = status;
            document.getElementById('merchant-agents-input').value = agents;

            if (id) {
                document.getElementById('merchant-modal-title').textContent = 'Edit Merchant';
                document.getElementById('merchant-id-input').readOnly = true;
            } else {
                document.getElementById('merchant-modal-title').textContent = 'Add New Merchant';
                document.getElementById('merchant-id-input').readOnly = false;
            }
            modal.style.display = 'flex';
        }

        function closeMerchantModal() {
            document.getElementById('merchantModal').style.display = 'none';
        }

        function saveMerchant(event) {
            event.preventDefault();
            const id = document.getElementById('merchant-id-input').value;
            const name = document.getElementById('merchant-name-input').value;
            const category = document.getElementById('merchant-category-input').value;
            const status = document.getElementById('merchant-status-input').value;
            const agentsAssigned = document.getElementById('merchant-agents-input').value;

            if (merchantsData[id]) {
                merchantsData[id] = { ...merchantsData[id], name, category, status, agents: agentsAssigned };
                showCustomMessage('Merchant Updated!', `Merchant ${name} (ID: ${id}) updated.`, 'alert');
            } else {
                merchantsData[id] = { name, category, status, agents: agentsAssigned }; // Simplified
                showCustomMessage('Merchant Added!', `Merchant ${name} (ID: ${id}) added.`, 'alert');
            }
            closeMerchantModal();
            initMerchantTable(); // Refresh table
        }

        // Task Add/Edit Modal Functions
        function openTaskModal(description = '', assignedTo = '', priority = '', dueDate = '', status = '') {
            const modal = document.getElementById('taskModal');
            document.getElementById('task-description-input').value = description;
            document.getElementById('task-assigned-to-input').value = assignedTo;
            document.getElementById('task-priority-input').value = priority;
            document.getElementById('task-due-date-input').value = dueDate;
            document.getElementById('task-status-input').value = status;

            if (description) { // Using description as a simple indicator for edit mode
                document.getElementById('task-modal-title').textContent = 'Edit Task';
            } else {
                document.getElementById('task-modal-title').textContent = 'Create New Task';
            }
            modal.style.display = 'flex';
        }

        function closeTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        function saveTask(event) {
            event.preventDefault();
            const description = document.getElementById('task-description-input').value;
            const assignedTo = document.getElementById('task-assigned-to-input').value;
            const priority = document.getElementById('task-priority-input').value;
            const dueDate = document.getElementById('task-due-date-input').value;
            const status = document.getElementById('task-status-input').value;

            // In a real app, you'd handle adding/updating tasks in a data structure
            console.log('Saving Task:', { description, assignedTo, priority, dueDate, status });
            showCustomMessage('Task Saved!', `Task "${description}" saved successfully.`, 'alert');
            closeTaskModal();
            initTasksTable(); // Refresh tasks table
        }

        // Request Submission Functions
        function submitAgentDeletionRequest(event) {
            event.preventDefault();
            const agentId = document.getElementById('delete-agent-select').value;
            const reason = document.getElementById('delete-reason-select').value;
            const notes = document.getElementById('delete-notes').value;
            console.log('Submit Deletion Request:', { agentId, reason, notes });
            showCustomMessage('Request Submitted', `Deletion request for ${agentId} submitted.`, 'alert');
            // Reset form fields
            document.getElementById('delete-agent-select').value = '';
            document.getElementById('delete-reason-select').value = '';
            document.getElementById('delete-notes').value = '';
            initPendingRequestsTable(); // Refresh pending requests table
        }

        function submitAgentMappingRequest(event) {
            event.preventDefault();
            const agentId = document.getElementById('map-agent-select').value;
            const reason = document.getElementById('map-reason-select').value;
            const notes = document.getElementById('map-notes').value;
            console.log('Submit Mapping Request:', { agentId, reason, notes });
            showCustomMessage('Request Submitted', `Mapping request for ${agentId} submitted.`, 'alert');
            // Reset form fields
            document.getElementById('map-agent-select').value = '';
            document.getElementById('map-reason-select').value = '';
            document.getElementById('map-notes').value = '';
            initPendingRequestsTable(); // Refresh pending requests table
        }


        // Initialize DataTables
        function initAgentTable() {
            if (agentTableInstance) {
                agentTableInstance.destroy();
            }
            agentTableInstance = $('#agentTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true,
                data: Object.entries(agentsData).map(([id, agent]) => [ // Corrected: Use Object.entries
                    agent.name, id, agent.tier, 
                    `<span class="status-badge status-${agent.status}">${agent.status.charAt(0).toUpperCase() + agent.status.slice(1)}</span>`,
                    agent.lastActivity, agent.transactions, `TZS ${agent.volume}`,
                    `<button class="text-blue-600 hover:text-blue-800 mr-2" title="View Profile" onclick="showAgentProfile('${id}')">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="text-green-600 hover:text-green-800 mr-2" title="Edit Agent" onclick="openAgentModal('${id}', '${agent.name}', '${agent.tier}', '${agent.status}', '${agent.regDate}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-800" title="Remove Agent" onclick="confirmDelete('Agent ${agent.name}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>`
                ]),
                columns: [
                    { title: "Agent Name" }, { title: "Agent ID" }, { title: "Tier" }, 
                    { title: "Status" }, { title: "Last Activity" }, { title: "Total Transactions" }, 
                    { title: "Total Volume (TZS)" }, { title: "Actions", orderable: false, searchable: false }
                ],
                initComplete: function() {
                    this.api().columns(3).every(function() { // Column 3 is 'Status'
                        var column = this; 
                        var select = $('#agentFilter'); 
                        select.off('change').on('change', function() {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val()); 
                            column.search(val === 'all' ? '' : val, true, false).draw();
                        });
                    });
                }
            });
        }

        function initASRTablesAndCharts() {
            if (asrTableInstance) { asrTableInstance.destroy(); }
            asrTableInstance = $('#asrTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true,
                data: Object.entries(asrsData).map(([id, asr]) => [ // Corrected: Use Object.entries
                    asr.name, id, asr.area, asr.status,
                    `<button class="text-green-600 hover:text-green-800 mr-2" title="Edit ASR" onclick="openASRModal('${id}', '${asr.name}', '${asr.area}', '${asr.status}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-800" title="Remove ASR" onclick="confirmDelete('ASR ${asr.name}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>`
                ]),
                columns: [
                    { title: "ASR Name" }, { title: "ASR ID" }, { title: "Assigned Area" }, { title: "Status" },
                    { title: "Actions", orderable: false, searchable: false }
                ]
            });

            if (asrFloatTableInstance) { asrFloatTableInstance.destroy(); }
            asrFloatTableInstance = $('#asrFloatTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true
            });

            if (asrRecruitmentTableInstance) { asrRecruitmentTableInstance.destroy(); }
            asrRecruitmentTableInstance = $('#asrRecruitmentTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true
            });

            if (agentsUnderAsrTableInstance) { agentsUnderAsrTableInstance.destroy(); }
            agentsUnderAsrTableInstance = $('#agentsUnderAsrTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true,
                initComplete: function() {
                    this.api().columns(2).every(function() { // Column 2 is 'Assigned ASR'
                        var column = this; 
                        var select = $('#asrAgentFilter'); 
                        select.off('change').on('change', function() {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val()); 
                            column.search(val === 'all' ? '' : val, true, false).draw();
                        });
                    });
                }
            });
        }

        function initMerchantTable() {
            if (merchantTableInstance) {
                merchantTableInstance.destroy();
            }
            merchantTableInstance = $('#merchantTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true,
                data: Object.entries(merchantsData).map(([id, merchant]) => [ // Corrected: Use Object.entries
                    merchant.name, id, merchant.category,
                    `<span class="status-badge status-${merchant.status}">${merchant.status.charAt(0).toUpperCase() + merchant.status.slice(1)}</span>`,
                    merchant.agents, 'Today, TZS 1,250', // Placeholder for last settlement
                    `<button class="text-green-600 hover:text-green-800 mr-2" title="Edit Merchant" onclick="openMerchantModal('${id}', '${merchant.name}', '${merchant.category}', '${merchant.status}', '${merchant.agents}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-800" title="Remove Merchant" onclick="confirmDelete('Merchant ${merchant.name}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>`
                ]),
                columns: [
                    { title: "Merchant Name" }, { title: "Merchant ID" }, { title: "Category" },
                    { title: "Status" }, { title: "Agents" }, { title: "Last Settlement (TZS)" },
                    { title: "Actions", orderable: false, searchable: false }
                ],
                initComplete: function() {
                    this.api().columns(3).every(function() { // Column 3 is 'Status'
                        var column = this; 
                        var select = $('#merchantFilter'); 
                        select.off('change').on('change', function() {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val()); 
                            column.search(val === 'all' ? '' : val, true, false).draw();
                        });
                    });
                }
            });
        }

        function initCommissionTable() {
            // Check if DataTable is already initialized on #commissionTable
            if ($.fn.DataTable.isDataTable('#commissionTable')) {
                $('#commissionTable').DataTable().destroy();
            }
            commissionTableInstance = $('#commissionTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true
            });
        }

        function initPendingRequestsTable() {
            if (pendingRequestsTableInstance) {
                pendingRequestsTableInstance.destroy();
            }
            pendingRequestsTableInstance = $('#pendingRequestsTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true,
                data: requestsData.map(req => [
                    req.id, req.type, req.agent, req.reason, req.submitted,
                    `<span class="status-badge status-active">${req.status}</span>`, // Assuming all pending are 'active' for badge color
                    `<button class="text-blue-600 hover:text-blue-800 mr-2" title="View Details" onclick="showCustomMessage('Admin Action', 'View details for ${req.id}.', 'alert')">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="text-green-600 hover:text-green-800 mr-2" title="Approve Request" onclick="showCustomMessage('Admin Action', 'Approve ${req.id}.', 'alert')">
                        <i class="fas fa-check"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-800" title="Reject Request" onclick="showCustomMessage('Admin Action', 'Reject ${req.id}.', 'alert')">
                        <i class="fas fa-times"></i>
                    </button>`
                ]),
                columns: [
                    { title: "Request ID" }, { title: "Type" }, { title: "Agent" },
                    { title: "Reason" }, { title: "Submitted" }, { title: "Status" },
                    { title: "Actions", orderable: false, searchable: false }
                ],
                initComplete: function() {
                    this.api().columns(5).every(function() { // Column 5 is 'Status'
                        var column = this; 
                        var select = $('#requestFilter'); 
                        select.off('change').on('change', function() {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val()); 
                            column.search(val === 'all' ? '' : val, true, false).draw();
                        });
                    });
                }
            });
        }

        function initTasksTable() {
            if (tasksTableInstance) {
                tasksTableInstance.destroy();
            }
            tasksTableInstance = $('#tasksTable').DataTable({
                dom: 'Bfrtip',
                buttons: ['copy', 'csv', 'excel'],
                responsive: true,
                data: tasksData.map(task => [
                    task.description, task.assignedTo,
                    `<span class="badge badge-${task.priority.toLowerCase()}">${task.priority}</span>`, // Assuming badge classes match priority
                    task.dueDate,
                    `<span class="status-badge status-${task.status.toLowerCase().replace(' ', '-')}">${task.status}</span>`,
                    `<button class="text-green-600 hover:text-green-800 mr-2" title="Edit Task" onclick="openTaskModal('${task.description}', '${task.assignedTo}', '${task.priority}', '${task.dueDate}', '${task.status}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-800" title="Remove Task" onclick="confirmDelete('Task: ${task.description}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>`
                ]),
                columns: [
                    { title: "Task" }, { title: "Assigned To" }, { title: "Priority" },
                    { title: "Due Date" }, { title: "Status" },
                    { title: "Actions", orderable: false, searchable: false }
                ],
                initComplete: function() {
                    this.api().columns(4).every(function() { // Column 4 is 'Status'
                        var column = this; 
                        var select = $('#taskFilter'); 
                        select.off('change').on('change', function() {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val()); 
                            column.search(val === 'all' ? '' : val, true, false).draw();
                        });
                    });
                }
            });
        }


        // Initialize Chart.js Charts
        function initAgentActivityChart() {
            const ctx = document.getElementById('agentActivityChart');
            if (agentActivityChartInstance) {
                agentActivityChartInstance.destroy();
            }
            agentActivityChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: new Date().getDate()}, (_, i) => i + 1),
                    datasets: [{
                        label: 'Active Agents',
                        data: [32, 34, 36, 35, 38, 37, 39, 40, 38, 39, 41, 42, 40, 42, 41, 43, 42, 44, 43, 42, 41, 40, 42, 41, 43, 42, 44, 45, 44, 42].slice(0, new Date().getDate()), // Adjust data length
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: 'Base Agents',
                        data: Array(new Date().getDate()).fill(39), // Adjust data length
                        borderColor: '#94a3b8',
                        borderDash: [5, 5],
                        borderWidth: 1,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 30
                        }
                    }
                }
            });
        }

        function initFloatDistributionChart() {
            const ctx = document.getElementById('floatDistributionChart');
            if (floatDistributionChartInstance) {
                floatDistributionChartInstance.destroy();
            }
            floatDistributionChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Aggregator to Agent',
                        data: [6500, 7200, 6800, 7950],
                        backgroundColor: '#10b981'
                    }, {
                        label: 'Agent to Aggregator',
                        data: [8200, 8900, 9300, 8780],
                        backgroundColor: '#3b82f6'
                    }, {
                        label: 'Total Float',
                        data: [14700, 16100, 16100, 16730],
                        backgroundColor: '#8b5cf6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `TZS ${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'TZS ' + (value / 1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        function initCommissionChart() {
            const ctx = document.getElementById('commissionChart');
            if (commissionChartInstance) {
                commissionChartInstance.destroy();
            }
            commissionChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Commission Earned',
                        data: [4200, 4800, 4500, 5200, 5600, 4900],
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Monthly Commission Earnings',
                            font: {
                                size: 14
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `TZS ${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'TZS ' + (value / 1000) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Logout function
        function logout() {
            showCustomMessage('Logout', 'Logging out... Redirecting to login page.', 'alert');
            // In a real application, this would clear session data and perform a redirect.
            // For the Canvas environment, direct redirection to a non-existent local file
            // like 'index.html' will cause a 'SyntaxError'.
            // Therefore, we remove the direct redirect for Canvas compatibility.
            // If this were a deployed web app, you would uncomment the line below:
            // setTimeout(() => { window.location.href = 'index.html'; }, 1000); 
        }

        // Initialize functionality on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial active nav item (Dashboard) and show its section
            const initialNavItem = document.querySelector('.nav-item[href="#dashboard-section"]');
            if (initialNavItem) {
                showSection(initialNavItem, 'dashboard-section');
            } else {
                // Fallback: if no active class, default to dashboard
                const defaultDashboard = document.getElementById('dashboard-section');
                if (defaultDashboard) {
                    defaultDashboard.classList.add('active');
                    initAgentActivityChart(); // Initialize dashboard charts if it's the default
                    initFloatDistributionChart();
                }
            }
             // Event listener for month select in commissions section
             const monthSelect = document.getElementById('month-select');
            if (monthSelect) {
                monthSelect.addEventListener('change', function() {
                    initCommissionChart();
                });
            }
        });
    </script>
</body>
</html>
